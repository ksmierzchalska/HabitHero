{% extends "base.html" %}

{% block body %}
<div class="history-page">
    <div class="container">
        <div class="big-box box-purple">
            <div class="history-header">
                <h1>Twoja historia</h1>
                <p class="subtitle">PrzeglƒÖdaj uko≈Ñczone cele, wyzwania oraz nieaktywne nawyki</p>
            </div>
            <div class="filters">
                <a href="?filter=all" class="filter-btn {% if filter_type == 'all' %}active{% endif %}">Wszystko</a>
                <a href="?filter=goals" class="filter-btn {% if filter_type == 'goals' %}active{% endif %}">Cele</a>
                <a href="?filter=challenges" class="filter-btn {% if filter_type == 'challenges' %}active{% endif %}">Wyzwania</a>
                <a href="?filter=habits" class="filter-btn {% if filter_type == 'habits' %}active{% endif %}">Nawyki</a>
            </div>
        </div>

        <!-- Cele g≈Ç√≥wne -->
        {% if filter_type in ['all', 'goals'] and completed_goals %}
        <div class="big-box box-green">
            <section class="history-section">
                <h2>Uko≈Ñczone cele g≈Ç√≥wne ({{ completed_goals|length }})</h2>
                {% for goal in completed_goals %}
                <div class="item-card">
                    <h3>{{ goal[1] }}</h3>
                    <div class="item-details">
                        <div class="detail-row">
                            <span class="detail-label">Czas trwania:</span>
                            <span class="detail-value">{{ goal[2] }} dni</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Utworzono:</span>
                            <span class="detail-value">{{ goal[3].strftime('%d.%m.%Y') }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Uko≈Ñczono:</span>
                            <span class="detail-value">{{ goal[4].strftime('%d.%m.%Y') if goal[4] else 'Data nieznana' }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Zdobyto:</span>
                            <span class="detail-value points">+350 pkt</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </section>
        </div>
        {% endif %}

        <!-- Wyzwania -->
        {% if filter_type in ['all', 'challenges'] and completed_challenges %}
        <div class="big-box box-red">
            <section class="history-section">
                <h2>Uko≈Ñczone wyzwania ({{ completed_challenges|length }})</h2>
                {% for challenge in completed_challenges %}
                <div class="item-card">
                    <h3>{{ challenge[1] }}</h3>
                    <div class="item-details">
                        <div class="detail-row">
                            <span class="detail-label">Sekcja:</span>
                            <span class="detail-value">{{ challenge[2] }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Czas trwania:</span>
                            <span class="detail-value">{{ challenge[3] }} dni</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Poziom:</span>
                            <span class="detail-value">{{ challenge[4] }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Zdobyto:</span>
                            <span class="detail-value points">+{{ challenge[5] }} pkt</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Do≈Çaczono:</span>
                            <span class="detail-value">{{ challenge[6].strftime('%d.%m.%Y') }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Uko≈Ñczono:</span>
                            <span class="detail-value">{{ challenge[7].strftime('%d.%m.%Y') }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </section>
        </div>
        {% endif %}

        <!-- Nawyki -->
        {% if filter_type in ['all', 'habits'] and inactive_habits %}
        <div class="big-box box-blue">
            <section class="history-section">
                <h2>Nieaktywne nawyki ({{ inactive_habits|length }})</h2>
                {% for habit in inactive_habits %}
                <div class="item-card">
                    <div class="habit-header">
                        <h3>{{ habit[1] }}</h3>
                    </div>

                    {% if habit[2] %}
                    <p class="item-details">Opis: {{ habit[2] }}</p>
                    {% endif %}

                    <div class="item-details">
                        <div class="detail-row">
                            <span class="detail-label">Cel:</span>
                            <span class="detail-value">{{ habit[3] }} {{ habit[5] or '' }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ostatnia passa:</span>
                            <span class="detail-value">{{ habit[8] }} dni</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Najlepsza passa:</span>
                            <span class="detail-value">{{ habit[9] }} dni</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Kategoria:</span>
                            <span class="detail-value">{{ habit[6] }}</span>
                        </div>
                    </div>
                    <div class="habit-actions">
                        <form method="POST" action="{{ url_for('activate_habit', habit_id=habit[0]) }}">
                            <button type="submit" class="btn-action">‚ñ∂Ô∏è Aktywuj</button>
                        </form>
                        <form method="POST" action="{{ url_for('delete_habit_permanently', habit_id=habit[0]) }}"
                              onsubmit="return confirm('Na pewno usunƒÖƒá ten nawyk?')">
                            <button type="submit" class="btn-action">üóëÔ∏è Usu≈Ñ</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </section>
        </div>
        {% endif %}

        <!-- Komunikat gdy brak wynik√≥w -->
        {% if (filter_type == 'all' and not completed_goals and not completed_challenges and not inactive_habits) or
              (filter_type == 'goals' and not completed_goals) or
              (filter_type == 'challenges' and not completed_challenges) or
              (filter_type == 'habits' and not inactive_habits) %}
        <div class="big-box box-yellow">
            <div class="no-results">
                <h3>Brak wynik√≥w</h3>
                <p>Nie znaleziono ≈ºadnych element√≥w dla wybranego filtra</p>
            </div>
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}