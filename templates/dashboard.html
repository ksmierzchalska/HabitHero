{% extends "base.html" %}

{% block body %}


<div class="dashboard-page">
    <div class="container">
        <!-- Nagłówek -->
        <div class="header">
            <h1>Dashboard</h1>
        </div>

        <!-- Szybkie statystyki -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ habit_stats|length }}</div>
                <div class="stat-label">Aktywne nawyki</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ habit_stats|map(attribute="3")|max if habit_stats else 0 }}</div>
                <div class="stat-label">Najlepsza passa</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ current_user.total_points or 0 }}</div>
                <div class="stat-label">Łączne punkty</div>
            </div>
        </div>

        <!-- Progres tygodniowy -->
        <div class="big-box box-purple">
            <div class="section">
                <h2>Progres z ostatnich 7 dni</h2>
                {% if weekly_progress %}
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Wykonane nawyki</th>
                                    <th>Cele osiągnięte</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for progress in weekly_progress %}
                                <tr>
                                    <td>{{ progress[0] }}</td>
                                    <td>{{ progress[1] }}</td>
                                    <td>{{ progress[2] }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="subtitle">Brak danych z ostatnich 7 dni</p>
                {% endif %}
            </div>
        </div>

        <!-- Twoja passa -->
        <div class="big-box box-red">
            <div class="section">
                <h2>Twoja aktualna passa</h2>
                <div class="streak-display">
                    {% for day in streak_history %}
                    <div class="day {% if day.completed %}completed{% elif day.is_today %}today{% else %}missed{% endif %}"
                         title="{{ day.date }} - {{ day.day_name }}">
                        {{ day.day_label }}
                    </div>
                    {% endfor %}
                </div>
                <div class="subtitle">
                    {% if current_streak > 0 %}
                         Passa: <strong>{{ current_streak }} dni</strong> z rzędu!
                    {% else %}
                         Zacznij nową passę już dziś!
                    {% endif %}
                </div>
            </div>
        </div>



        <!-- Statystyki nawyków -->
        <div class="big-box box-yellow">
            <div class="section">
                <h2>Twoje nawyki</h2>
                {% if habit_stats %}
                    <div class="habits-list">
                        {% for stat in habit_stats %}
                        <div class="habit-item">
                            <div class="habit-name">{{ stat[0] }}</div>
                            <div class="habit-details">
                                <span>Wykonane: {{ stat[1] }} dni</span>
                                <span>Aktualna passa: {{ stat[3] }} dni</span>
                                <span>Najlepsza passa: {{ stat[5] }} dni</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="subtitle">Brak aktywnych nawyków. Dodaj pierwszy nawyk!</p>
                {% endif %}
            </div>
        </div>

        <!-- ODZNAKI ZA PASSY - POPRAWIONE -->
        <!--
        <!-- ODZNAKI ZA PASSY -->
<div class="big-box box-purple">
    <div class="section">
        <h2>Twoje odznaki za passy</h2>
        {% set user_streak_badges = [] %}
        {% for badge in user_badges if badge[3] == 'streak' %}
            {% set _ = user_streak_badges.append(badge) %}
        {% endfor %}

        {% if user_streak_badges %}
            <div class="badges-grid"> <!-- ZMIANA: badges-container → badges-grid -->
                {% for badge in user_streak_badges %}
                <article class="badge-card"> <!-- ZMIANA: badge-item → badge-card -->
                    <div class="badge-icon"><span class="material-symbols-outlined">Trophy</span></div>
                    <div class="badge-content">
                        <h3 class="badge-title">{{ badge[1] }}</h3>
                        <p class="badge-description">{{ badge[2] }}</p>
                        <time class="badge-date">Zdobyto: {{ badge[4].strftime('%d.%m.%Y') }}</time>
                    </div>
                </article>
                {% endfor %}
            </div>
        {% else %}
            <p class="subtitle">Jeszcze nie zdobyłeś odznak za passy! Utrzymuj passę aby zdobyć odznaki.</p>
        {% endif %}
    </div>
</div>
    </div>
</div>


{% endblock %}